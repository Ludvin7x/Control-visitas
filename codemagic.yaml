workflows:
  android-release:
    name: Build Android Release APK
    max_build_duration: 60
    environment:
      groups:
        - firebase
        - signing
      vars:
        GRADLE_TASK: assembleRelease
        KEYSTORE_PATH: keystore.jks    # Solo el nombre, porque gradle buscarÃ¡ dentro de app/
    scripts:
      - echo "ğŸ”“ Decodificando keystore..."
      - echo $KEYSTORE_BASE64 | base64 --decode > app/$KEYSTORE_PATH
      
      - echo "ğŸ”“ Decodificando google-services.json..."
      - mkdir -p app
      - echo $GOOGLE_SERVICES_JSON | base64 --decode > app/google-services.json

      - echo "ğŸ› ï¸ Listando archivos en app para verificar keystore..."
      - ls -l app/

      - echo "ğŸ› ï¸ Otorgando permisos..."
      - chmod +x ./gradlew

      - echo "ğŸš€ Iniciando compilaciÃ³n..."
      - |
        ./gradlew $GRADLE_TASK \
          -Pandroid.injected.signing.store.file=../app/$KEYSTORE_PATH \
          -Pandroid.injected.signing.store.password=$KEYSTORE_PASSWORD \
          -Pandroid.injected.signing.key.alias=$KEY_ALIAS \
          -Pandroid.injected.signing.key.password=$KEY_PASSWORD

      - echo "âœ… APK compilado, listando archivos..."
      - find app/build/outputs/apk/

    artifacts:
      - app/build/outputs/apk/release/app-release.apk